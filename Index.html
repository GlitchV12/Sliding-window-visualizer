<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sliding Window Visualizer</title>
<style>
body { margin:0; font-family:Arial; display:flex; height:100vh; background:#f7f7f7; }
.sidebar { width:30%; background:#fff; border-right:1px solid #ddd; display:flex; flex-direction:column; }
.main { flex:1; display:flex; flex-direction:column; align-items:center; height:100vh; }

.topbar { padding:10px; border-bottom:1px solid #ddd; }
select, button, input { padding:6px; border:none; background:#333; color:#fff; border-radius:4px; cursor:pointer; }
button { margin-right:6px; }
button:hover { opacity:0.85; }
input { width:60px; background:#fff; color:#000; border:1px solid #ccc; }

.code-box { flex:1; padding:10px; overflow:auto; border-bottom:1px solid #ddd; font-size:13px; }
.line { display:block; padding:2px 4px; white-space:pre; }
.highlight { background:#ddd; }

.explanation { height:120px; padding:10px; background:#fafafa; font-size:14px; }

.games { display:flex; justify-content:center; width:100%; padding:10px 0; }
.center { margin-top:auto; margin-bottom:auto; display:flex; flex-direction:column; align-items:center; }
.controls { margin:10px; }

.array { display:flex; gap:8px; flex-wrap:wrap; justify-content:center; margin-top:10px; }
.box { width:40px; height:40px; display:flex; align-items:center; justify-content:center; border-radius:6px; background:#e0e0e0; transition:all 0.3s ease; }
.window { background:#83f28f; transform:scale(1.1); }

/* Popup */
.popup-overlay {
  position:fixed; top:0; left:0; width:100%; height:100%;
  background:rgba(0,0,0,0.3); display:none; justify-content:center; align-items:center;
}
.popup {
  background:#fff; padding:20px; border-radius:8px; min-width:250px; text-align:center;
}
.popup button { margin-top:10px; }
</style>
</head>
<body>

<div class="sidebar">
  <div class="topbar">
    <select id="lang" onchange="switchLang()">
      <option value="js">JavaScript</option>
      <option value="java">Java</option>
      <option value="cpp">C++</option>
      <option value="python">Python</option>
      <option value="c">C</option>
    </select>
  </div>

  <div class="code-box" id="code"></div>
  <div class="explanation" id="explanation">Click Start</div>
</div>

<div class="main">
  <div class="games">
    <button onclick="loadGame(1)">Max Sum</button>
    <button onclick="loadGame(2)">Fixed Window</button>
    <button onclick="loadGame(3)">Longest Substring</button>
  </div>

  <div class="center">
    <div class="controls">
      Nodes: <input type="number" id="nodes" min="1" max="50" value="6">
      Window K: <input type="number" id="kval" min="1" value="3">
      Target: <input type="number" id="target" value="7">
      <button onclick="generateArray()">Generate</button>
      <button onclick="start()">Start</button>
      <button onclick="reset()">Reset</button>
    </div>
    <div class="array" id="array"></div>
  </div>
</div>

<!-- Popup -->
<div class="popup-overlay" id="popup">
  <div class="popup">
    <div id="popupText"></div>
    <button onclick="closePopup()">X</button>
  </div>
</div>

<script>
let arr = [2,1,5,1,3,2];
let k = 3;
let target = 7;
let interval;
let currentLine = -1;
let lang = 'js';
let found = false;
let foundRange = '';

const codeMap = {
  js: [
    'let windowSum = 0;',
    'for (let i = 0; i < k; i++) {',
    '  windowSum += arr[i];',
    '}',
    'let maxSum = windowSum;',
    'for (let i = k; i < arr.length; i++) {',
    '  windowSum += arr[i];',
    '  windowSum -= arr[i - k];',
    '  maxSum = Math.max(maxSum, windowSum);',
    '}'
  ]
};

function renderCode() {
  const box = document.getElementById('code');
  box.innerHTML = '';
  codeMap[lang].forEach((line, i) => {
    const div = document.createElement('div');
    div.className = 'line' + (i === currentLine ? ' highlight' : '');
    div.textContent = line;
    box.appendChild(div);
  });
}

function switchLang() {
  lang = document.getElementById('lang').value;
  renderCode();
}

function render(ws = -1, we = -1) {
  const container = document.getElementById('array');
  container.innerHTML = '';
  arr.forEach((v, i) => {
    const d = document.createElement('div');
    d.className = 'box' + (i >= ws && i <= we ? ' window' : '');
    d.innerText = v;
    container.appendChild(d);
  });
}

function generateArray() {
  const n = Math.min(50, parseInt(document.getElementById('nodes').value));
  k = parseInt(document.getElementById('kval').value);
  target = parseInt(document.getElementById('target').value);
  arr = [];
  for (let i = 0; i < n; i++) arr.push(Math.floor(Math.random() * 9) + 1);
  reset(); render();
}

function start() {
  let i = 0, windowSum = 0;
  found = false; foundRange = '';
  clearInterval(interval);

  interval = setInterval(() => {
    if (i < k) {
      windowSum += arr[i];
      render(0, i);
      document.getElementById('explanation').innerText = `Adding ${arr[i]}`;
      i++;
    } else if (i < arr.length) {
      windowSum += arr[i];
      windowSum -= arr[i - k];
      render(i - k + 1, i);
      document.getElementById('explanation').innerText = `Slide: +${arr[i]}, -${arr[i - k]}`;

      if (windowSum === target && !found) {
        found = true;
        foundRange = `${i - k + 1} to ${i}`;
      }
      i++;
    } else {
      clearInterval(interval);
      showResult();
    }
  }, 800);
}

function showResult() {
  let msg = '';
  if (found) msg = `Target found at window index ${foundRange}`;
  else msg = 'Target not found';
  document.getElementById('popupText').innerText = msg;
  document.getElementById('popup').style.display = 'flex';
}

function closePopup() {
  document.getElementById('popup').style.display = 'none';
}

function reset() {
  clearInterval(interval);
  currentLine = -1;
  render();
  renderCode();
}

function loadGame(type) {
  reset();
  if (type === 1) { arr = [2,1,5,1,3,2]; k = 3; target = 9; }
  if (type === 2) { arr = [4,2,2,6,1]; k = 2; target = 8; }
  if (type === 3) { arr = [1,2,1,3,4,2,3]; k = 3; target = 6; }
  render();
  document.getElementById('explanation').innerText = 'Game loaded';
}

render(); renderCode();
</script>

</body>
</html>
